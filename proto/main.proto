syntax = "proto3";

package proto;

import "google/protobuf/timestamp.proto";

service Game {
    rpc Stream (stream Request) returns (stream Response) {}
}

// Shared message types.

message Coordinate {
    int32 x = 1;
    int32 y = 2;
}

message Player {
    string player = 1;
    Coordinate position = 2;
}

// Message actions.

message Connect {
    string player = 1;
}

message Initialize {
    Coordinate position = 1;
    repeated Player players = 2;
}

message Move {
    enum Direction {
        UP = 0;
        DOWN = 1;
        LEFT = 2;
        RIGHT = 3;
        STOP = 4;
    }
    Direction direction = 1;
}

message Laser {
    enum Direction {
        UP = 0;
        DOWN = 1;
        LEFT = 2;
        RIGHT = 3;
        STOP = 4;
    }
    Direction direction = 1;
    string uuid = 2;
}

message AddPlayer {
    Coordinate position = 1;
}

message UpdatePlayer {
    Coordinate position = 1;
}

message RemovePlayer {}

message AddLaser {
    Laser laser = 1;
    Coordinate position = 2;
    google.protobuf.Timestamp starttime = 3;
}

// Wraps multiple message actions.

message Request {
    oneof action {
        Connect connect = 1;
        Move move = 2;
        Laser laser = 3;
    }
}

message Response {
    string player = 1;
    oneof action {
        Initialize initialize = 3;
        AddPlayer addplayer = 4;
        UpdatePlayer updateplayer = 5;
        RemovePlayer removeplayer = 6;
        AddLaser addlaser = 7;
    }
}
